<% layout("/layouts/boilerplate.ejs") %>

    <style>
        #filters {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            /* Use gap for spacing instead of margin-right */
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #ddd;
        }

        .filter {
            text-align: center;
            padding: 0.5rem;
            opacity: 0.7;
            transition: opacity 0.3s, transform 0.2s;
            border-bottom: 3px solid transparent;
            /* Prepare for active state */
        }

        .filter:hover {
            opacity: 1;
            cursor: pointer;
            transform: scale(1.05);
        }

        .filter.active {
            opacity: 1;
            border-bottom: 3px solid #ff385c;
            /* Highlight for active filter */
            font-weight: bold;
        }

        .filter div {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .tax-info {
            display: none;
        }

        .tax-toggle {
            border: 1px solid black;
            border-radius: 1rem;
            height: 3.5rem;
            padding: 1rem;
            margin-left: auto;
            display: flex;
            align-items: center;

        }
    </style>

    <body>

        <div id="filters">
            <div class="filter">
                <div><i class="fa-solid fa-globe"></i></div>
                <p>Global</p>
            </div>
            <div class="filter">
                <div><i class="fa-solid fa-mountain"></i></div>
                <p>Mountain</p>
            </div>
            <div class="filter">
                <div><i class="fa-solid fa-water"></i></i></div>
                <p>Island</p>
            </div>
            <div class="filter">
                <div><i class="fa-solid fa-tree"></i></i></div>
                <p>Greenery</p>
            </div>
            <div class="filter">
                <div><i class="fa-solid fa-snowflake"></i></i></div>
                <p>Snow</p>
            </div>
            <div class="filter">
                <div><i class="fa-solid fa-sun"></i></i></div>
                <p>Desert</p>
            </div>
            <div class="filter">
                <div><i class="fa-solid fa-umbrella-beach"></i></i></div>
                <p>Beach</p>
            </div>
            <div class="filter">
                <div><i class="fa-solid fa-city"></i></i></div>
                <p>Urban</p>
            </div>

            <div class="tax-toggle ">
                <div class="form-check-reverse form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault">
                    <label class="form-check-label" for="switchCheckDefault">Display Taxes</label>
                </div>
            </div>

        </div>

        <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">

            <% if (allListings.length===0) { %>
                <p class="text-center text-muted fs-5 w-100">
                    No listings found<% if (typeof searchQuery !=='undefined' && searchQuery) { %> for "<%= searchQuery
                            %>"<% } %>
                </p>
                <% } %>

                    <% for (let list of allListings) { %>
                        <a href="/listings/<%= list.id %>" class="listing-link">
                            <div class="card col listing-card">
                                <img src="<%= list.image.url %>" class="card-img-top" alt="..." style="height: 20rem;">
                                <div class="card-img-overlay"></div>
                                <div class="card-body">
                                    <p class="card-text">
                                        <b>
                                            <%= list.title %>
                                        </b> <br>
                                        &#8377; <%= list.price.toLocaleString("en-IN") %>/night
                                            <i class="tax-info">&nbsp;&nbsp; +18% GST</i>
                                    </p>
                                </div>
                            </div>
                        </a>
                        <% } %>

        </div>


        <script>
            const filters = document.querySelectorAll('.filter');

            filters.forEach(filter => {
                filter.addEventListener('click', () => {
                    const category = filter.querySelector('p').innerText;
                    if (category === "global") {
                        window.location.href = "/listings";
                    } else {
                        window.location.href = `/listings/filter/${category}`;
                    }
                });
            });

            // Highlight the active filter
            const activeFilter = "<%= activeFilter %>";
            filters.forEach(f => {
                const cat = f.querySelector('p').innerText;
                if (cat === activeFilter) {
                    f.classList.add('active');
                }
            });

            let taxSwitch = document.getElementById("switchCheckDefault");
            taxSwitch.addEventListener("click", () => {
                let taxInfo = document.getElementsByClassName("tax-info");
                for (info of taxInfo) {
                    if (info.style.display != "inline") {
                        info.style.display = "inline";
                    } else {
                        info.style.display = "none";
                    }
                }

            });

        </script>


    </body>